"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[51764],{854453:(t,e,s)=>{s.d(e,{SessionSpec:()=>S});var r=s(988124),n=s(674981),i=s(476172);function o(t,e){return t.compareTo(e)}class a{constructor(t,e,s){this._dayOfWeek=t,this._start=e,this._length=s}start(){return this._start+r.minutesPerDay*this.sessionStartDaysOffset()}startOffset(){return this._start}sessionStartDaysOffset(){return this._start>=0?0:this._start%r.minutesPerDay==0?-Math.ceil(this._start/r.minutesPerDay):-Math.floor(this._start/r.minutesPerDay)}sessionEndDaysOffset(){const t=this._start+this._length;return t>=0?0:t%r.minutesPerDay==0?-Math.ceil(t/r.minutesPerDay):-Math.floor(t/r.minutesPerDay)}isOvernight(){return this._start<0}dayOfWeek(){return this._dayOfWeek}sessionStartDayOfWeek(){let t=this._dayOfWeek-this.sessionStartDaysOffset();return t<r.SUNDAY&&(t+=7),t}sessionEndDayOfWeek(){let t=this.sessionStartDayOfWeek()+this.sessionEndDaysOffset();return t>r.SATURDAY&&(t=1),t}length(){return this._length}weight(){return this._dayOfWeek*r.minutesPerDay+this._start}compareTo(t){const e=this.weight(),s=e+this._length,r=t.weight(),n=r+t._length;return e<=r&&r<s||r<=e&&e<n?0:e>r?1:-1}contains(t){const e=60*r.get_hours(t)+r.get_minutes(t);let s=r.get_day_of_week(t)-this._dayOfWeek;s>0&&(s-=7);const n=s*r.minutesPerDay+e;return n>=this._start&&n<this._start+this._length}}class l{constructor(t,e,s){this.weekIndex=t,this.entryIndex=e,this.entries=s}getEntry(){return this.entries[this.entryIndex]}}var u=s(201089);const d=[r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY],c=[r.SUNDAY,r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY,r.SATURDAY],h=(0,u.getLogger)("Chart.Model.SessionSpec");function p(t){return t>=48&&t<=57}class _{constructor(){this.entries=[],this.firstDayOfWeek=r.MONDAY,this.weekEndsCount=-1,this.maxTradingDayLength=0}parseSessions(t,e){var s;let r=!1;this._clear(),this.timezone=t;const{hasErrors:n,spec:i}=this._parseFirstDayOfWeek(e);if("24x7"===i.toLowerCase())for(const t of c)this.entries.push(_._createSessionEntry(t,0,0,0,0));else{let t=!1;const e=new Map;for(const s of i.split("|")){const n=s.split(":");if(1!==n.length&&2!==n.length){r=!0,h.logError(`Bad session section: ${s}`);continue}const i=1===n.length;if(i){if(t){r=!0,h.logError(`Duplicated default section: ${s}`);continue}t=!0}const o=i?d:_._parseWorkingDays(n[1]);for(const t of o)i&&e.has(t)||e.set(t,n[0])}for(const t of c){const s=e.get(t);if(void 0!==s)for(const e of s.split(",")){const{hasErrors:s,sessionEntry:n}=_._parseSessionEntry(t,e);s&&(r=s),this.entries.push(n)}}}this.entries.sort(o);const a=new Map;for(const t of this.entries){const e=t.dayOfWeek();a.set(e,t.length()+(null!==(s=a.get(e))&&void 0!==s?s:0))}return this.maxTradingDayLength=0,a.forEach((t=>{this.maxTradingDayLength=Math.max(this.maxTradingDayLength,t)})),this.weekEndsCount=7-a.size,r||n}static parseHolidaysAndCorrections(t,e,s){const n=new Map,i=new Map,o=t=>{const e=this._parseDay(t),s=e.toString(),r=i.get(s);return void 0!==r?r:(i.set(s,e),e)};if(""!==e){const t=[]
;for(const s of e.split(",")){if(8!==s.length)throw new Error(`bad holiday date: ${s}`);const e=o(s);n.set(e,t)}}if(""===s)return n;const l=r.get_timezone("Etc/UTC");for(const t of s.split(";")){const e=t.split(":");if(2!==e.length)throw new Error(`bad correction section: ${t}`);const s=[];if("dayoff"!==e[0])for(const t of e[0].split(","))s.push(this._parseSessionEntry(1,t).sessionEntry);for(const t of e[1].split(",")){if(8!==t.length)throw new Error(`bad correction date: ${t}`);const e=o(t),i=r.get_day_of_week(r.get_cal(l,e.year,e.month-1,e.day)),u=[];for(const t of s)u.push(new a(i,t.startOffset(),t.length()));n.set(e,u)}}return n}_clear(){this.entries=[],this.timezone="",this.firstDayOfWeek=r.MONDAY,this.weekEndsCount=-1}_parseFirstDayOfWeek(t){const e=t.split(";");if(e.length>2)return h.logError(`Only one \`first day\` specification expected @ session ${t}`),{hasErrors:!0,spec:t};if(1===e.length)return{hasErrors:!1,spec:t};let s=1;let n=e[0].indexOf("-")>=0?NaN:parseInt(e[0]);return isNaN(n)&&(s=0,n=parseInt(e[1])),n<r.SUNDAY||n>r.SATURDAY?(h.logError(`Unexpected day index @ session: ${t}; day index ${n}`),{hasErrors:!0,spec:t}):(this.firstDayOfWeek=n,{hasErrors:!1,spec:e[s]})}static _parseDay(t){const e=parseInt(t.substring(0,4)),s=parseInt(t.substring(4,6)),r=parseInt(t.substring(6,8));return new i.BusinessDay(e,s,r)}static _parseSessionEntry(t,e){let s=!1,r=e.split("-");2!==r.length&&(s=!0,h.logError(`Bad sessions entry: ${e}`),r=["0000","0000"]);let n=0,i=r[0];if(i.includes("F")){const t=i.split("F");i=t[0],n=""!==t[1]?parseInt(t[1]):1}let o=0,a=r[1];if(a.includes("F")){const t=a.split("F");a=t[0],o=""!==t[1]?parseInt(t[1]):1}if(!this._isCorrectSession(i)||!this._isCorrectSession(a))throw new Error(`Incorrect entry syntax: ${e}`);const l=i,u=a;return{hasErrors:s,sessionEntry:this._createSessionEntry(t,_._minutesFromHHMM(l),_._minutesFromHHMM(u),n,o)}}static _isCorrectSession(t){return 4===t.length&&p(t.charCodeAt(0))&&p(t.charCodeAt(1))&&p(t.charCodeAt(2))&&p(t.charCodeAt(3))}static _parseWorkingDays(t){const e=[];for(let s=0;s<t.length;s++){const r=+t[s];-1===e.indexOf(r)&&e.push(r)}return e}static _minutesFromHHMM(t){return r.get_minutes_from_hhmm(t)}static _createSessionEntry(t,e,s,n,i){0===s&&(s=r.minutesPerDay),n===i&&s<=e&&(n+=1),n>0&&(e-=n*r.minutesPerDay),i>0&&(s-=i*r.minutesPerDay);return new a(t,e,s-e)}}function y(t,e){return t.compareTo(e)<0}function f(t,e){const s=(0,n.lowerbound)(t,e,((t,e)=>-1===t.day.compareTo(e)));return s===t.length?null:t[s]}const g=621672192e5;class S{constructor(t="Etc/UTC",e="0000-0000",s="",n=""){this._entries=[],this._firstDayOfWeek=r.MONDAY,this._entriesHash=new Map,this._holidayAndCorrectionMap=new Map,this._holidaySessions=[];const i=new _;i.parseSessions(t,e),this._entries=i.entries,this._timezone=i.timezone,this._spec=e,this._firstDayOfWeek=i.firstDayOfWeek,this._weekEndsCount=i.weekEndsCount,this._maxTradingDayLength=i.maxTradingDayLength;const o=_.parseHolidaysAndCorrections(t,s,n),a=r.get_timezone(t);this._isThereCorrections=""!==s||""!==n,o.forEach(((t,e)=>{
this._holidayAndCorrectionMap.set(e.toString(),t),this._holidaySessions.push({day:e,sessions:t});const s=this.getWeekIndex(e.toCalendar(a));this._entriesHash.set(s,null)})),this._holidaySessions.sort(((t,e)=>t.day.compareTo(e.day)))}entries(){return this._entries}timezone(){return this._timezone}spec(){return this._spec}firstDayOfWeek(){return this._firstDayOfWeek}addSessionEntry(t,e,s,n,i){0===s&&(s=r.minutesPerDay),n===i&&s<=e&&(n+=1),n>0&&(e-=n*r.minutesPerDay),i>0&&(s-=i*r.minutesPerDay);const o=s-e;this._entries.push(new a(t,e,o))}longestSessionLength(){let t=0,e=0;for(const e of this._holidaySessions)e.sessions.forEach((e=>{t=Math.max(t,e.length())}));return this._entries.forEach((t=>{e=Math.max(e,t.length())})),Math.max(t,e)}isWeekEnd(t){const e=(0,n.lowerbound)(this._entries,new a(t,0,0),((t,e)=>t.dayOfWeek()<e.dayOfWeek()));return e>this._entries.length-1||this._entries[e].dayOfWeek()!==t}isCalWeekEnd(t){const e=r.get_day_of_week(t);if(!this._isThereCorrections)return this.isWeekEnd(e);const s=i.BusinessDay.fromCalendar(t),n=this._holidayAndCorrectionMap.get(s.toString());return void 0===n?this.isWeekEnd(e):0===n.length}hasWeekEnds(){return this.weekEndsCount()>0}weekEndsCount(){return this._weekEndsCount}maxTradingDayLength(){return this._maxTradingDayLength}holidaysFromYearStart(t){if(!this._isThereCorrections)return 0;const e=r.get_timezone(this._timezone),s=new i.BusinessDay(r.get_year(t),r.JANUARY,1),n=i.BusinessDay.fromCalendar(t);let o=0;const a=this._selectHolidays(s,n);for(let t=0;t<a.length;t++){const s=a[t].day.toCalendar(e);this.isWeekEnd(r.get_day_of_week(s))?o+=0===a[t].sessions.length?0:-1:o+=0===a[t].sessions.length?1:0}return o}intradayCanBeBuiltFrom24x7(t){return this._entries.every((e=>e.start()%t==0&&e.length()%t==0))}indexOfSession(t,e,s){const i=this._getEntriesForWeek(t);let o=(0,n.lowerbound)(i,new a(e,s,0),y);if(o!==i.length)return new l(t,o,i);let u=t;const d=7-e+this._firstDayOfWeek-1;for(s=-(r.minutesPerDay-s+d*r.minutesPerDay);;){u++;const t=this._getEntriesForWeek(u);if(0!==t.length)return o=(0,n.lowerbound)(t,new a(this._firstDayOfWeek,s,0),y),new l(u,o,t)}}findSession(t,e,s,r=0){const n=this.indexOfSession(t,e,s),i=n.entries;let o=n.entryIndex;if(0!==r){const t=i[o].dayOfWeek(),e=r>0?1:-1;for(;;){const s=o+e;if(s<0||s>=i.length||i[s].dayOfWeek()!==t)break;o=s}}return new l(n.weekIndex,o,i)}getWeekIndex(t){if(!this._isThereCorrections)return 0;const e=r.get_day_of_week(t)-r.SUNDAY,s=r.get_timezone("Etc/UTC"),n=r.get_cal(s,r.get_year(t),r.get_month(t),r.get_day_of_month(t)-e);return Math.floor((n.getTime()+g)/1e3/86400/7)}correctTradingDay(t){const e=r.get_day_of_week(t),s=60*r.get_hours(t)+r.get_minutes(t),n=this.getWeekIndex(t),i=this.findSession(n,e,s,0),o=i.getEntry().dayOfWeek()-e+7*(i.weekIndex-n);return 0!==o&&r.add_date(t,o),t}alignToSessionStart(t,e=0){const s=r.get_day_of_week(t),n=60*r.get_hours(t)+r.get_minutes(t),i=this.getWeekIndex(t),o=this.findSession(i,s,n,e),a=o.getEntry(),l=a.dayOfWeek()-s+7*(o.weekIndex-i);0!==l&&r.add_date(t,l);const u=a.startOffset()
;return r.set_hms(t,u/60,u%60,0,0,r.get_timezone(this._timezone)),a.length()}businessDaysToCalendarDays(t,e){let s=this.getWeekIndex(t),n=r.get_day_of_week(t),i=0,o=0;for(;o<e;){const t=this._getEntriesForWeek(s);let a=0;for(let s=n;s<=r.SATURDAY;s++){i++;let r=!0;for(;a<t.length&&!(t[a].dayOfWeek()>s);)t[a].dayOfWeek()<s||r&&(r=!1,o++),a++;if(o>=e)return i}s++,n=r.SUNDAY}return i}calendarDaysToBusinessDays(t,e){let s=this.getWeekIndex(t),n=r.get_day_of_week(t),i=0,o=0;for(;i<e;){const t=this._getEntriesForWeek(s);let a=0;for(let s=n;s<=r.SATURDAY;s++){i++;let r=!0;for(;a<t.length&&!(t[a].dayOfWeek()>s);)t[a].dayOfWeek()<s||r&&(r=!1,o++),a++;if(i>=e)return o}s++,n=r.SUNDAY}return o}alignToNearestSessionStart(t,e){return this._alignToNearestSessionValue(t,e,this._entrySessionStart.bind(this))}alignToNearestSessionEnd(t,e){return this._alignToNearestSessionValue(t,e,this._entrySessionEnd.bind(this))}leftBorderOfDailyBar(t){const e=this._getEntriesForDay(t);return 0===e.length?null:(e.sort(o),this._getLeftEntryBorder(t,e[0]))}bordersOfDailyBar(t){const e=this._getEntriesForDay(t);if(0===e.length)return null;e.sort(o);const s=this._getLeftEntryBorder(t,e[0]),n=e[e.length-1],i=r.clone(t);let a=60*(n.startOffset()+n.length())-1;const l=Math.floor(a/3600);return a-=3600*l,r.set_hms(i,l,a/60,a%60,0,r.get_timezone(this._timezone)),{from:s,to:i}}getEntriesForWeekByCalendar(t){const e=this.getWeekIndex(t);return this._getEntriesForWeek(e)}_getEntriesForWeek(t){let e=this._entriesHash.get(t);if(void 0===e)return this._entries;if(null!==e)return e;const s=r.get_timezone(this._timezone);e=this._entries.slice();const n=this._weekIndexToCalendar(t),a=this._weekIndexToCalendar(t+1),l=i.BusinessDay.fromCalendar(n),u=i.BusinessDay.fromCalendar(a),d=this._selectHolidays(l,u);for(const t of d){const n=t.day.toCalendar(s),i=r.get_day_of_week(n);e=e.filter((t=>t.dayOfWeek()!==i)),e=e.concat(t.sessions)}return e.sort(o),this._entriesHash.set(t,e),e}_selectHolidays(t,e){const s=[];let r=t;for(;;){const t=f(this._holidaySessions,r);if(null===t)return s;if(!t.day.before(e))return s;s.push(t),r=t.day.addDays(1)}}_weekIndexToCalendar(t){const e=1e3*(86400*t*7+86400)-g,s=r.get_cal_from_unix_timestamp_ms(r.get_timezone("Etc/UTC"),e),n=r.get_timezone("Etc/UTC");return r.get_cal(n,r.get_year(s),r.get_month(s),r.get_day_of_month(s))}_alignToNearestSessionValue(t,e,s){const n=r.get_day_of_week(t),i=60*r.get_hours(t)+r.get_minutes(t),o=this.getWeekIndex(t);let a=this.findSession(o,n,i);if(a.getEntry().contains(t)&&o===a.weekIndex||1===e)return s(a,r.clone(t),e);const u=a.getEntry(),d=u.contains(t),c=o===a.weekIndex,h=u.sessionStartDaysOffset()-u.dayOfWeek()>=0;if(d&&(c||h))return s(a,r.clone(t),e);let p=a.entryIndex-1;if(p<0){let t=a.weekIndex,e=a.entries;for(;p<0;)t--,e=this._getEntriesForWeek(t),p+=e.length;a=new l(t,p,e)}else a=new l(a.weekIndex,p,a.entries);return s(a,r.clone(t),e)}_entrySessionStart(t,e,s){return this._entrySessionValue(t,e,s,(t=>60*t.start()))}_entrySessionEnd(t,e,s){
return this._entrySessionValue(t,e,s,(t=>60*(t.start()+t.length())-1))}_entrySessionValue(t,e,s,n){let i=r.get_day_of_week(e);const o=t.getEntry();let a=o.dayOfWeek()-o.sessionStartDaysOffset();const l=this.getWeekIndex(e);let u=t.weekIndex-l,d=!1;if(a<r.SUNDAY&&(u<=0?d=!0:u--,a+=7),(u>0&&s>=0||u<0&&s<0)&&r.add_date(e,7*u),!o.contains(e)){let t=a-i;d&&s<0&&(t=-(7-a+i)),r.add_date(e,t),i=r.get_day_of_week(e)}o.isOvernight()&&i===o.dayOfWeek()&&r.add_date(e,-o.sessionStartDaysOffset());let c=n(o);const h=Math.floor(c/3600);return c-=3600*h,r.set_hms(e,h,c/60,c%60,0,r.get_timezone(this._timezone)),e}_getEntriesForDay(t){const e=r.get_day_of_week(t);return this._getEntriesForWeek(this.getWeekIndex(t)).filter((t=>t.dayOfWeek()===e))}_getLeftEntryBorder(t,e){const s=r.clone(t),n=e.startOffset();return r.set_hms(s,n/60,n%60,0,0,r.get_timezone(this._timezone)),s}}},975630:(t,e,s)=>{s.d(e,{LineToolAnchoredVWAP:()=>B});var r=s(650151),n=s(526075),i=s(389137),o=s(6826),a=s.n(o),l=s(244842),u=s(173948),d=s(855611),c=s(826908),h=s(354950),p=s.n(h),_=s(827523),y=s(311862),f=s(291784),g=s(534741),S=s(817724),m=s(31712),P=s(923033),I=s(246733);class w extends P.PriceAxisView{constructor(t){super(),this._model=t.model(),this._source=t}_updateRendererData(t,e,s){t.visible=!1,e.visible=!1;const r=this._source.model(),n=this._source.priceScale();if(null===n)return;if(!r.isPriceScaleVisible(n))return;const i=this._source.lastValueData("",!1);i.noData||(s.background=(0,I.resetTransparency)(i.color),s.textColor=this.generateTextColor(i.color),s.coordinate=i.coordinate,s.floatCoordinate=i.floatCoordinate,this._showAxisLabel()&&(t.text=i.text,t.visible=!0))}_showAxisLabel(){return this._source.properties().childs().axisLabelVisible.value()}}var D=s(86441),x=s(329007),b=s(268008),A=s(342308);class v extends b.StudyPlotPaneView{constructor(t,e,s,r){super(t,e,s,r),this._line=t}_updateImplFull(){if(super._updateImplFull(!0),window.TradingView.printing||!this._line.hasAlert.value()||this._model.readOnly()||this._model.isInReplay())return!1;const t=this._items;if(!this._renderer.isEmpty()&&t.length>0){const e=t[t.length-1],s=this._model.timeScale().width();if(e.x<0||t[0].x>s)return!1;const r=Math.min(s-5,e.x);let n=e.y;if(e.x>r){let s=t.length-2;for(;s>=0;){const i=t[s];if(i.x<=r){const t=(r-i.x)/(e.x-i.x);n=i.y+(e.y-i.y)*t;break}s-=1}}const i=new D.Point(r,n);return this._renderer.append(new A.PaneRendererClockIcon({points:[i],color:this._line.getAlertIsActive()?this._lineColor:x.Constants.DrawingIconColor,horzMargin:-16})),!0}return!1}_updateImplLight(){this._updateImplFull()}}var C=s(201089),T=s(853965),M=s(552698),k=s(1584),E=s(461794),V=s(964824);const W=(0,C.getLogger)("Chart.AnchoredVWAP"),L=(0,_.studyIdString)("AnchoredVWAP","tv-basicstudies");function F(t,e,s,n){return"calculate_stDev"in(0,r.ensureDefined)(t.inputs)||void 0===n.inputs.find((t=>"calculate_stDev"===t.id))||((0,r.ensureDefined)(e.inputs).calculate_stDev=!1),e.styles&&(O(e.styles.VWAP),O(e.styles.UpperBand),O(e.styles.LowerBand),O(e.styles.UpperBand_2),
O(e.styles.LowerBand_2),O(e.styles.UpperBand_3),O(e.styles.LowerBand_3)),e}function O(t){void 0!==t&&void 0!==t.visible&&(t.display=t.visible?15:0,delete t.visible)}class B extends S.StudyLineDataSource{constructor(t,e,s,n,i){s=s||(0,r.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:L}));const o=null!=e?e:B.createProperties(t);super(t,s,"anchoredvwap",o,n,i);const[a,l,u,d,c,h,p]=this.metaInfo().plots,_=t.mainSeries(),y=[new v(this,_,t,a.id)];l&&u&&(y.push(new b.StudyPlotPaneView(this,_,t,l.id)),y.push(new b.StudyPlotPaneView(this,_,t,u.id))),d&&c&&h&&p&&(y.push(new b.StudyPlotPaneView(this,_,t,d.id)),y.push(new b.StudyPlotPaneView(this,_,t,c.id)),y.push(new b.StudyPlotPaneView(this,_,t,h.id)),y.push(new b.StudyPlotPaneView(this,_,t,p.id))),this._properties.childs().areaBackground&&y.splice(0,0,new k.AreaBackgroundPaneView(this,t)),this._lastValuePriceAxisView=new w(this),this._anchorPriceCalculated=!1,this._onInputsReadyCallbacks=[],this._setPaneViews(y),t.properties().childs().scalesProperties.childs().showStudyLastValue.subscribe(this,this._onShowStudyLastValueChanged),o.onRestoreFactoryDefaults().subscribe(this,this._onRestoreFactoryDefaults)}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribeAll(this),this.model().properties().childs().scalesProperties.childs().showStudyLastValue.unsubscribeAll(this),this._onInputsReadyCallbacks=[],super.destroy()}canHasAlert(){return!0}pointsCount(){return 1}priceAxisViews(t,e){if(e!==this.priceScale()||this.isSourceHidden())return null;const s=super.priceAxisViews(t,e);return null===s?[this._lastValuePriceAxisView]:[...s,this._lastValuePriceAxisView]}updateAllViews(t){super.updateAllViews(t),this._lastValuePriceAxisView.update(t)}offset(t){return 0}firstValue(){return this._model.mainSeries().firstValue()}getMinFirstBarIndexForPlot(){return-1/0}priceRange(t,e){if(!this._isReady()||this.isSourceHidden())return null;const s=this.plots().minMaxOnRangeCached(t,e,[{name:this.metaInfo().plots[0].id,offset:0}]);if(null===s)return null;const n=(0,r.ensureNotNull)(this.priceScale());return n.isLog()?new f.PriceRange(n.priceToLogical(s.min),n.priceToLogical(s.max)):new f.PriceRange(s.min,s.max)}isIncludedInAutoScale(){return!0}lastValueData(t,e,s){const n={noData:!0},o=this.priceScale();if(this._model.timeScale().isEmpty()||null===this.priceScale()||null===o||o.isEmpty()||this.plots().isEmpty())return n;const a=this._model.timeScale().visibleBarsStrictRange();if(null===a)return n;if(!this.properties().childs().visible.value())return n;const l=this.plots().search(a.lastBar(),g.PlotRowSearchMode.NearestLeft,1);if(null===l)return n;const u=a.contains(l.index),d=!e&&u?l:(0,r.ensureNotNull)(this.plots().last());if(!d||!(0,i.isNumber)(d.value[1]))return n;const c=d.value[1],h=this.properties().childs().styles.childs().VWAP,p=(0,r.ensureNotNull)(this.firstValue()),_=o.priceToCoordinate(c,p);return{...o.getFormattedValues(c,p),noData:!1,price:c,color:h.childs().color.value(),coordinate:_,floatCoordinate:_,index:d.index}}restoreData(t){
super.restoreData(t),void 0!==t.data&&(this._anchorPriceCalculated=!0)}properties(){return super.properties()}sourceId(){return this._studyId()}hasStateForAlert(){return l.enabled("alerts")&&null!==this._inputs}alertCreationAvailable(){return new(a())(!this.hasAlert.value()&&this.hasStateForAlert()).readonly()}stateForAlert(){const t=this.metaInfo(),e=(0,c.plotsForAlert)(t,this.offset.bind(this),["VWAP"]),s=(0,c.collectDepsForAlert)([this],this.id()),r=s.idForAlert,n=s.studyDependencies,i=s.inputsForAlert,o=(this.priceScale()||this.model().mainSeries().priceScale()).formatter(),a=o?d.FormattersSerializer.serialize(o):null;return{id:r,uniqueId:r,type:M.StateForAlertType.StudyLineTool,title:(0,E.clean)(this.translatedType(),!0),shortTitle:(0,E.clean)(this.translatedType(),!0),shortDescription:(0,E.clean)(t.shortDescription||"Study",!0),interval:this._model.mainSeries().interval(),fullId:t.fullId,isTVScript:Boolean(t.isTVScript),isTVScriptStrategy:Boolean(t.isTVScriptStrategy),isTVLibrary:Boolean(t.isTVLibrary),hasAlertFunction:Boolean(t.hasAlertFunction),plots:e,inputs:i,alerts:t.alerts,scriptIdPart:t.scriptIdPart,scriptVersion:t.pine?t.pine.version:"-1",callStudyDependencies:(0,u.formatCallstudyArg)((0,c.dependenciesForAlerts)([],this._model.studyMetaInfoRepository())),studyDependencies:n,formatter:a}}inputsForAlertState(){null===this._inputs&&W.logError("Could not get inputsForAlertState if VWAP has no inputs");const{start_time:t,source:e}=this.inputs();return{start_time:t,source:e}}inputs(){return(0,r.ensureNotNull)(this._inputs)}idForAlert(){return(0,c.collectDepsForAlert)([this],this.id()).idForAlert}defaultPlotIdForAlert(){return this.metaInfo().plots[0].id}isPlotVisibleAt(t,e){return(this.properties().childs().styles.childs()[t].childs().display.value()&e)===e}static createProperties(t,e){const s=n.StudyMetaInfo.getStudyPropertyRootNameById(L),o=(0,r.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:L})),a=(0,T.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(o,o,(0,i.merge)((0,i.clone)(a),null!=e?e:{}),t.studyVersioning())}static studyId(){return L}static createPropertiesFromStudyMetaInfoAndState(t,e,s,r){const n=(0,y.prepareStudyPropertiesForLoadChart)(t,e,s,r,F);return this._configureProperties(n),n}_onPointsetUpdated(t){super._onPointsetUpdated(t),this._onStudyInputsMayChange()}_studyInputs(t){(0,r.assert)(1===t.length,"all the line tool points should be defined");const e=t[0],s=this._getPointTime(e,!1);return null===s?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(["start_time"]),start_time:1e3*s}}_isReady(){return super._isReady()&&(null!==this._inputs||this._anchorPriceCalculated)&&this.model().lineBeingEdited()!==this}_onDataCleared(){super._onDataCleared(),this._anchorPriceCalculated=!1}_onInputsChanged(){if(super._onInputsChanged(),null!==this._inputs){for(const t of this._onInputsReadyCallbacks)try{t(this._inputs)}catch(t){W.logError(t.stack||t.message)}
this._onInputsReadyCallbacks=[]}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(33038),s.e(16200),s.e(90288),s.e(56386),s.e(18537)]).then(s.bind(s,865993))).AnchoredVWAPDefinitionsViewModel}_updateAnchorsPrice(t){if(!t&&(this._anchorPriceCalculated||!this.isActualSymbol()))return;const e=this.firstValue(),s=this.points();if(null===e||0===s.length)return;const r=s[0].index,n=this.plots().valueAt(r);if(null===n)return;const i=n[1];null!=i&&(this._points[0].price=i,this._timePoint[0].price=i,this._anchorPriceCalculated=!0)}_synchronizeAlert(t){this._onInputsReady((()=>super._synchronizeAlert(t)))}static _configureProperties(t){super._configureProperties(t),t.hasChild("axisLabelVisible")||t.addChild("axisLabelVisible",new(p())(true));const e=t.childs().styles.childs().VWAP.childs().linewidth,s=t.childs().styles.childs().VWAP.childs().color;t.addChild("linesWidths",new m.LineToolWidthsProperty([e])),t.addChild("linesColors",new m.LineToolColorsProperty([s]))}_onInputsReady(t){null!==this._inputs?t(this._inputs):this._onInputsReadyCallbacks.push(t)}_onShowStudyLastValueChanged(){this._lastValuePriceAxisView.update((0,V.sourceChangeEvent)(this.id())),this.model().updateSource(this)}_onRestoreFactoryDefaults(){this.properties().childs().axisLabelVisible.setValue(true)}}},928890:(t,e,s)=>{s.d(e,{LineToolFixedRangeVolumeProfile:()=>h});var r=s(650151),n=s(224153),i=s(526075),o=s(817724),a=s(827523),l=s(853965),u=s(389137),d=s(311862);const c=(0,a.studyIdString)("VbPFixed","tv-basicstudies");class h extends n.LineToolVbPFixed{constructor(t,e,s,r,n){const i=s||t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:c});super(t,e,i,r,n)}calcIsActualSymbol(){o.StudyLineDataSource.prototype.calcIsActualSymbol.apply(this)}boundToSymbol(){return!0}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}static studyId(){return c}static createProperties(t,e){const s=i.StudyMetaInfo.getStudyPropertyRootNameById(c),n=(0,r.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:c})),o=(0,l.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(n,n,(0,u.merge)((0,u.clone)(o),null!=e?e:{}),t.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(t,e,s,r){const n=(0,d.prepareStudyPropertiesForLoadChart)(t,e,s,r);return this._configureProperties(n),n}}},855353:(t,e,s)=>{s.d(e,{LineToolStudyStatusView:()=>n});var r=s(833642);class n extends r.StatusView{constructor(t){super(t.statusProvider({}))}getSplitTitle(){return this._statusProvider.getSplitTitle()}}},484775:(t,e,s)=>{s.r(e),s.d(e,{LineStudyMtpAnalysis:()=>h,LineStudyMtpDecisionPoint:()=>_,LineStudyMtpDownWave1OrA:()=>A,LineStudyMtpDownWave2OrB:()=>C,LineStudyMtpDownWave3:()=>M,LineStudyMtpDownWave4:()=>E,LineStudyMtpDownWave5:()=>W,LineStudyMtpDownWaveC:()=>F,LineStudyMtpElliotWaveMain:()=>m,LineStudyMtpElliotWaveMajor:()=>I,LineStudyMtpElliotWaveMinor:()=>D,LineStudyMtpRiskReward:()=>f,LineStudyMtpUpWave1OrA:()=>B,
LineStudyMtpUpWave2OrB:()=>N,LineStudyMtpUpWave3:()=>z,LineStudyMtpUpWave4:()=>Y,LineStudyMtpUpWave5:()=>j,LineStudyMtpUpWaveC:()=>G});var r=s(650151),n=s(827523),i=s(582533),o=s(817724),a=s(943994),l=s(311862);function u(t){return(0,n.studyIdString)(t,"mtp-mtpredictor")}class d extends o.StudyLineDataSource{constructor(t,e,s,r,n,o){const l=u(r),c=s||t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:l}),h=e||d._createPropertiesFromStudyMetaInfo(c,t.studyVersioning());super(t,c,r,h,n,o),this._formatter=new a.VolumeFormatter,(0,i.createGraphicsPaneViews)(this,t).then(this._setPaneViews.bind(this))}formatter(){return this._formatter}static _createPropertiesFromMtpStudyShortIdAndState(t,e){return super._createPropertiesFromStudyIdAndState(u(t),e)}static _createPropertiesFromStudyMetaInfo(t,e){const s=(0,l.prepareStudyProperties)(t,{},null,e,[]);return super._configureProperties(s),s}}const c="mtp_tsanalysis";class h extends d{constructor(t,e,s,r,n){super(t,e,s,c,r,n)}pointsCount(){return 1}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(c,t)}static studyId(){return u(c)}_studyInputs(t){(0,r.assert)(1===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0);return null===e?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*e}}}const p="mtp_decisionpoint";class _ extends d{constructor(t,e,s,r,n){super(t,e,s,p,r,n),this._symbolIntervalChanged=!1,this._model.mainSeries().onSymbolIntervalChanged().subscribe(this,this._onSymbolIntervalChanged)}destroy(){this._model.mainSeries().onSymbolIntervalChanged().unsubscribeAll(this),super.destroy()}pointsCount(){return 1}onData(t){super.onData(t),this._symbolIntervalChanged=!1}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(p,t)}static studyId(){return u(p)}_studyInputs(t){(0,r.assert)(1===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0);return null===e?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),symbolIntervalChanged:this._symbolIntervalChanged,bar:1e3*e}}_onSymbolIntervalChanged(){this._symbolIntervalChanged=!0}}const y="mtp_riskreward";class f extends d{constructor(t,e,s,r,n){super(t,e,s,y,r,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(y,t)}static getTooltipText(t){return t&&0!==t._points.length?1===t._points.length?"Select Stop Bar":2===t._points.length?"Select Target Point":null:"Select Entry Setup Bar"}static studyId(){return u(y)}_studyInputs(t){(0,r.assert)(3===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0),s=this._getPointTime(t[1],!0),n=this._getPointTime(t[2],!0);return null===e||null===s||null===n?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),entry_bar:1e3*e,stop_bar:1e3*s,target_bar:1e3*n,target_price:t[2].price}}}class g extends d{
pointsCount(){return 1}_studyInputs(t){(0,r.assert)(1===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0);return null===e?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*e}}}const S="mtp_ew_main";class m extends g{constructor(t,e,s,r,n){super(t,e,s,S,r,n)}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(S,t)}static studyId(){return u(S)}}const P="mtp_ew_major";class I extends g{constructor(t,e,s,r,n){super(t,e,s,P,r,n)}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(P,t)}static studyId(){return u(P)}}const w="mtp_ew_minor";class D extends g{constructor(t,e,s,r,n){super(t,e,s,w,r,n)}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(w,t)}static studyId(){return u(w)}}class x extends d{_studyInputs(t){(0,r.assert)(t.length===this.pointsCount(),"all the line tool points should be defined");const e={...this.properties().childs().inputs.state()};for(let s=0;s<this.pointsCount();++s){const r=this._getPointTime(t[s],!0);if(null===r)return this._subscribeApplyInputsOnSeriesCompleted(),null;e[`bar${s}`]=1e3*r}return e}}const b="mtp_wpt_down1ora";class A extends x{constructor(t,e,s,r,n){super(t,e,s,b,r,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(b,t)}static getTooltipText(t){return`Down Wave 1 or A: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(b)}}const v="mtp_wpt_down2orb";class C extends x{constructor(t,e,s,r,n){super(t,e,s,v,r,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(v,t)}static getTooltipText(t){return`Down Wave 2 or B: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(v)}}const T="mtp_wpt_down3";class M extends x{constructor(t,e,s,r,n){super(t,e,s,T,r,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(T,t)}static getTooltipText(t){return`Down Wave 3: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(T)}}const k="mtp_wpt_down4";class E extends x{constructor(t,e,s,r,n){super(t,e,s,k,r,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(k,t)}static getTooltipText(t){return`Down Wave 4: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(k)}}const V="mtp_wpt_down5";class W extends x{constructor(t,e,s,r,n){super(t,e,s,V,r,n)}pointsCount(){return 5}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(V,t)}static getTooltipText(t){return`Down Wave 5: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(V)}}const L="mtp_wpt_downc";class F extends x{constructor(t,e,s,r,n){super(t,e,s,L,r,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(L,t)}static getTooltipText(t){
return`Down Wave C: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(L)}}const O="mtp_wpt_up1ora";class B extends x{constructor(t,e,s,r,n){super(t,e,s,O,r,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(O,t)}static getTooltipText(t){return`Up Wave 1 or A: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(O)}}const R="mtp_wpt_up2orb";class N extends x{constructor(t,e,s,r,n){super(t,e,s,R,r,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(R,t)}static getTooltipText(t){return`Up Wave 2 or B: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(R)}}const U="mtp_wpt_up3";class z extends x{constructor(t,e,s,r,n){super(t,e,s,U,r,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(U,t)}static getTooltipText(t){return`Up Wave 3: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(U)}}const H="mtp_wpt_up4";class Y extends x{constructor(t,e,s,r,n){super(t,e,s,H,r,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(H,t)}static getTooltipText(t){return`Up Wave 4: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(H)}}const $="mtp_wpt_up5";class j extends x{constructor(t,e,s,r,n){super(t,e,s,$,r,n)}pointsCount(){return 5}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState($,t)}static getTooltipText(t){return`Up Wave 5: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u($)}}const q="mtp_wpt_upc";class G extends x{constructor(t,e,s,r,n){super(t,e,s,q,r,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(q,t)}static getTooltipText(t){return`Up Wave C: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return u(q)}}},44004:(t,e,s)=>{s.d(e,{LineToolRegressionTrend:()=>f});var r=s(650151),n=s(732149),i=s(827523),o=s(526075),a=s(817724),l=s(311862),u=s(31712),d=s(389137),c=s(853965);const h=(0,i.studyIdString)("RegressionTrend","tv-basicstudies");function p(t){return void 0!==t.startPrice&&void 0!==t.endPrice}function _(t,e,s,r){return e.styles&&(y(e.styles.baseLine),y(e.styles.downLine),y(e.styles.upLine)),e}function y(t){void 0!==t&&void 0!==t.visible&&(t.display=t.visible?15:0,delete t.visible)}class f extends a.StudyLineDataSource{constructor(t,e,n,i,o){n=null!=n?n:(0,r.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:h}));super(t,n,"linreg_",null!=e?e:f.createProperties(t),i,o),this.version=2,this._trendData=null,Promise.all([s.e(13038),s.e(51583)]).then(s.bind(s,13105)).then((t=>{this._setPaneViews([new t.RegressionTrendPaneView(this,this._model)])}))}formatter(){throw new Error("This method should never be called")}pointsCount(){return 2}clearData(){this._trendData=null,super.clearData()}state(t){var e;const s=super.state(t);return t?{...s,
nonseriesdata:null!==(e=this._trendData)&&void 0!==e?e:void 0}:s}restoreData(t){var e;super.restoreData(t),this._trendData=null!==(e=t.nonseriesdata)&&void 0!==e?e:null}startIndex(){if(null===this._trendData||null===this._indexes)return null;const t=this._indexes[this._trendData.startIndex];return t!==n.INVALID_TIME_POINT_INDEX?t:null}endIndex(){if(null===this._trendData||null===this._indexes)return null;const t=this._indexes[this._trendData.endIndex];return t!==n.INVALID_TIME_POINT_INDEX?t:null}baseLine(){return null===this._trendData?null:this._trendData.baseLine}downLine(){return null===this._trendData?null:this._trendData.downLine}upLine(){return null===this._trendData?null:this._trendData.upLine}pearsons(){return null===this._trendData?null:this._trendData.pearsons}recalcStudyIfNeeded(){this._onStudyInputsMayChange()}cloneable(){return!1}static createProperties(t,e){const s=o.StudyMetaInfo.getStudyPropertyRootNameById(h),n=(0,r.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:h})),i=(0,c.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createRegressionTrendPropertiesFromStudyMetaInfoAndState(n,n,(0,d.merge)((0,d.clone)(i),null!=e?e:{}),t.studyVersioning())}static createRegressionTrendPropertiesFromStudyMetaInfoAndState(t,e,s,r){const n=(0,l.prepareStudyPropertiesForLoadChart)(t,e,s,r,_);return this._configureProperties(n),n}static studyId(){return h}_studyInputs(t){(0,r.assert)(2===t.length,"all the line tool points should be defined");const[e,s]=t;if(e.index===s.index)return null;const n=this._getPointTime(e.index<=s.index?e:s,!0),i=this._getPointTime(s.index>=e.index?s:e,!0);return null===n||null===i?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),"first bar time":1e3*n,"last bar time":1e3*i}}_onDataUpdated(t,e,s){null!==e&&(e.indexes_replace||(this._trendData=e.data),"nochange"!==s&&(this._indexes=s),super._onDataUpdated(t,e,s))}_isReady(){return null!==this._trendData&&void 0!==this._trendData.startIndex&&void 0!==this._trendData.endIndex&&p(this._trendData.upLine)&&p(this._trendData.baseLine)&&p(this._trendData.downLine)}_updateAnchorsPrice(){if(!this._trendData||(0,d.isNaN)(this._trendData.baseLine.startPrice)||(0,d.isNaN)(this._trendData.baseLine.endPrice))return;const{startPrice:t,endPrice:e}=this._trendData.baseLine;2===this._points.length&&(this._points[0].price=(0,r.ensureDefined)(t),this._points[1].price=(0,r.ensureDefined)(e),this._timePoint[0].price=(0,r.ensureDefined)(t),this._timePoint[1].price=(0,r.ensureDefined)(e))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(88601),s.e(33038),s.e(56894),s.e(68855),s.e(90288),s.e(56386),s.e(47924),s.e(60607)]).then(s.bind(s,422026))).RegressionTrendDefinitionsViewModel}static _configureProperties(t){super._configureProperties(t);const e=t.childs().styles.childs(),s=[e.upLine.childs().linewidth,e.downLine.childs().linewidth,e.baseLine.childs().linewidth];t.addChild("linesWidths",new u.LineToolWidthsProperty(s))}}},224153:(t,e,s)=>{s.d(e,{
LineToolVbPFixed:()=>g});var r=s(277973),n=s(650151),i=s(827523),o=s(526075),a=s(817724),l=s(582533),u=s(268008),d=s(964824),c=s(389137),h=s(853965),p=s(311862);const _=(0,i.studyIdString)("VbPFixed","tv-volumebyprice");function y(t,e,s,r){return e.styles&&(f(e.styles.developingPoc),f(e.styles.developingVAHigh),f(e.styles.developingVALow)),e}function f(t){void 0!==t&&void 0!==t.visible&&(t.display=t.visible?15:0,delete t.visible)}class g extends a.StudyLineDataSource{constructor(t,e,s,r,n){const i=s||t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:_});super(t,i,"vbpfixed_",null!=e?e:g.createProperties(t),r,n),this._createPaneViews().then((t=>{this._setPaneViews(t)})),this.clearData()}pointsCount(){return 2}boundToSymbol(){return!1}offset(t){return 0}getMinFirstBarIndexForPlot(){return-1/0}calcIsActualSymbol(){this._isActualSymbol=!0,this._isActualCurrency=!0,this._isActualUnit=!0,this.calcIsActualInterval()}cloneable(){return!1}isSynchronizable(){return!1}isPlotVisibleAt(t,e){return(this.properties().childs().styles.childs()[t].childs().display.value()&e)===e}preferredZOrder(){return 0}static createProperties(t,e){const s=o.StudyMetaInfo.getStudyPropertyRootNameById(_),r=(0,n.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:_})),i=(0,h.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(r,r,(0,c.merge)((0,c.clone)(i),null!=e?e:{}),t.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(t,e,s,r){const n=(0,p.prepareStudyPropertiesForLoadChart)(t,e,s,r,y);return this._configureProperties(n),n}static studyId(){return _}_studyInputs(t){(0,n.assert)(2===t.length,"all the line tool points should be defined");const[e,s]=t,r=Math.max(e.index,s.index),i=this._model.mainSeries().bars().lastIndex(),o=this._getPointTime(e.index<=s.index?e:s,!0),a=this._getPointTime(s.index>=e.index?s:e,!0);if(null===o||null===a)return this._subscribeApplyInputsOnSeriesCompleted(),null;return{...this.properties().childs().inputs.state(),first_bar_time:1e3*o,last_bar_time:1e3*a,subscribeRealtime:i===r,mapRightBoundaryToBarStartTime:!!this._needExtendToBarsEnding()||void 0}}_isReady(){return!(0,l.isStudyGraphicsEmpty)(this.graphics())}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(88601),s.e(33038),s.e(56894),s.e(68855),s.e(90288),s.e(56386),s.e(47924),s.e(60607)]).then(s.bind(s,762155))).StudyLineDataSourceDefinitionsViewModel}_onDataUpdated(){this._updateAnchors(),this.updateAllViews((0,d.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_updateAnchors(){const t=this._calculateAnchors();if(!t)return;const[{index:e,price:s},{index:r,price:n}]=t;if(this._timePoint.length&&(this._timePoint[0].price=s,this._timePoint[1].price=n),this._points.length){const t=this.model().timeScale(),i=t.indexToTimePoint(e),o=t.indexToTimePoint(e);this._points[0]={index:e,price:s,time:(0,c.isNumber)(i)?new Date(1e3*i):void 0},this._points[1]={index:r,price:n,time:(0,c.isNumber)(o)?new Date(1e3*o):void 0}}}
_calculateAnchors(){let t=null,e=null,s=null,n=null;if(this.graphics().hhists().forEach((r=>{r.forEach((r=>{const{priceLow:i,priceHigh:o,firstBarTime:a,lastBarTime:l}=r;(!t||i<t)&&(t=i),(!e||o>e)&&(e=o),(!s||a<s)&&(s=a),(!n||l>n)&&(n=l)}))})),!((0,r.default)(t)||(0,r.default)(e)||(0,r.default)(n)||(0,r.default)(s)))return[{price:e,index:s},{price:t,index:n}]}_updateAnchorsPrice(){const t=this._calculateAnchors();if(!t)return;const[{price:e},{price:s}]=t;this._timePoint.length&&(this._timePoint[0].price=e,this._timePoint[1].price=s),this._points.length&&(this._points[0].price=e,this._points[1].price=s)}async _createPaneViews(){var t;const e=this._metaInfo,r=e.graphics,n=[],i=this._needExtendToBarsEnding();if(r.hhists){const{HHistPaneView:e}=await Promise.all([s.e(13038),s.e(20507)]).then(s.bind(s,66424)),r=null===(t=this.properties().childs().graphics.childs().polygons)||void 0===t?void 0:t.childs();n.push(new e(this,this._model,void 0,null==r?void 0:r.histBoxBg,i))}if(r.horizlines){const{HorizLinePaneView:t}=await Promise.all([s.e(13038),s.e(20507)]).then(s.bind(s,722669));n.push(new t(this,this._model,void 0,i))}return e.plots.length>0&&n.push(this._createStudyPlotPaneView(e.plots[0].id,i)),e.plots.length>1&&n.push(this._createStudyPlotPaneView(e.plots[1].id,i)),e.plots.length>2&&n.push(this._createStudyPlotPaneView(e.plots[2].id,i)),n}_createStudyPlotPaneView(t,e){return new u.StudyPlotPaneView(this,this._model.mainSeries(),this._model,t,e)}_needExtendToBarsEnding(){var t;return void 0!==(null===(t=this.metaInfo().defaults.inputs)||void 0===t?void 0:t.mapRightBoundaryToBarStartTime)}}},342308:(t,e,s)=>{s.d(e,{PaneRendererClockIcon:()=>o});var r=s(315801),n=s(710455);const i=Math.sqrt(3);class o extends n.MediaCoordinatesPaneRenderer{constructor(t){super(),this.update(t)}update(t){var e;const s=t.points[0],r=null!==(e=t.points[1])&&void 0!==e?e:t.points[0],n=s.x-r.x,o=s.y-r.y;let a=t.horzMargin;void 0===a&&(a=n>0?10:-25),this._x=s.x+a,this._y=s.y+(0!==o&&Math.abs(n)*i<=Math.abs(o)?-7:o>0?-25:11),this._color=t.color}hitTest(t){return t.x<this._x||t.x>this._x+16||t.y<this._y||t.y>this._y+16?null:new r.HitTestResult(r.HitTarget.Regular)}_drawImpl(t){const e=t.context;e.translate(this._x-.5,this._y-.5),e.beginPath(),e.arc(8,9,6,0,2*Math.PI,!0),e.closePath(),e.moveTo(8,9),e.arc(8.5,5.5,.5,Math.PI,0),e.lineTo(9,10),e.arc(5.5,9.5,.5,.5*Math.PI,1.5*Math.PI),e.closePath(),e.moveTo(1.71,5.93),e.bezierCurveTo(-.61,2.83,3.86,-.76,6.39,2.18),e.bezierCurveTo(4.35,2.67,2.63,4.04,1.71,5.93),e.closePath(),e.moveTo(14.29,5.93),e.bezierCurveTo(16.61,2.83,12.14,-.76,9.61,2.18),e.bezierCurveTo(11.65,2.67,13.37,4.04,14.29,5.93),e.fillStyle=this._color,e.fill()}}},329007:(t,e,s)=>{var r;s.d(e,{Constants:()=>r}),function(t){t.DrawingIconColor="rgba( 170, 170, 170, 1)"}(r||(r={}))}}]);